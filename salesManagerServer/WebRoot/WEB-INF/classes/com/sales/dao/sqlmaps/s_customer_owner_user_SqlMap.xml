<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="s_customer_owner_user" >
  <resultMap id="abatorgenerated_SCustomerOwnerUserResult" class="com.sales.model.SCustomerOwnerUser" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    <result column="customer_owner_user_id" property="customerOwnerUserId" jdbcType="INTEGER" />
    <result column="customer_id" property="customerId" jdbcType="INTEGER" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="customer_name" property="customerName" jdbcType="VARCHAR" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="add_time" property="addTime" jdbcType="DATE" />
    <result column="over_time" property="overTime" jdbcType="DATE" />
    <result column="history_user_id" property="historyUserId" jdbcType="INTEGER" />
    <result column="salegen_id" property="salegenId" jdbcType="INTEGER" />
    <result column="finmanager_id" property="finmanagerId" jdbcType="INTEGER" />
    <result column="salegen_name" property="salegenName" jdbcType="VARCHAR" />
    <result column="finmanager_name" property="finmanagerName" jdbcType="VARCHAR" />
    
  </resultMap>
  <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_SCustomerOwnerUserResult" parameterClass="com.sales.model.SCustomerOwnerUser" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select cou.customer_owner_user_id, cou.customer_id, cou.user_id, cou.add_time, cou.over_time, cou.history_user_id, 
    u.user_name as user_name, c.FFullName as customer_name, sgu.user_name as salegen_name, fmu.user_name as finmanager_name,
    cou.salegen_id, cou.finmanager_id
    from s_customer_owner_user cou
    left join s_user u on cou.user_id = u.user_id
    left join t_customer c on cou.customer_id = c.customer_id
    left join s_user sgu on cou.salegen_id = sgu.user_id
	left join s_user fmu on cou.finmanager_id = fmu.user_id
    where cou.customer_owner_user_id = #customerOwnerUserId:INTEGER#
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="com.sales.model.SCustomerOwnerUser" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    delete from s_customer_owner_user
    where customer_owner_user_id = #customerOwnerUserId:INTEGER#
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="com.sales.model.SCustomerOwnerUser" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    insert into s_customer_owner_user (customer_owner_user_id, customer_id, user_id, add_time, salegen_id, finmanager_id)
    values (#customerOwnerUserId:INTEGER#, #customerId:INTEGER#, #userId:INTEGER#,#addTime:DATE#, #salegenId:INTEGER#, #finmanagerId:INTEGER#)
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="com.sales.model.SCustomerOwnerUser" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    update s_customer_owner_user
    set customer_id = #customerId:INTEGER#,
      user_id = #userId:INTEGER#
    where customer_owner_user_id = #customerOwnerUserId:INTEGER#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="com.sales.model.SCustomerOwnerUser" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    update s_customer_owner_user
    set
    history_user_id = user_id,
    over_time = #overTime:DATE#,
    user_id = null
    where customer_owner_user_id = #customerOwnerUserId:INTEGER#
  </update>
  <update id="updateCustomerOwerUserById" parameterClass="com.sales.model.SCustomerOwnerUser" > 
    update s_customer_owner_user
    set
    user_id = #userId:INTEGER#,
    salegen_id = #salegenId:INTEGER#,
    finmanager_id = #finmanagerId:INTEGER#,
    add_time = #addTime:DATE#
    where customer_owner_user_id = #customerOwnerUserId:INTEGER#
  </update>
  
  <select id="getCOUserListByUserId" resultMap="abatorgenerated_SCustomerOwnerUserResult" parameterClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select cou.customer_owner_user_id, cou.customer_id, cou.user_id, cou.add_time, cou.over_time, cou.history_user_id, 
    u.user_name as user_name, c.FFullName as customer_name, sgu.user_name as salegen_name, fmu.user_name as finmanager_name,
    cou.salegen_id, cou.finmanager_id
    from s_customer_owner_user cou
    left join s_user u on cou.user_id = u.user_id
    left join t_customer c on cou.customer_id = c.customer_id
    left join s_user sgu on cou.salegen_id = sgu.user_id
	left join s_user fmu on cou.finmanager_id = fmu.user_id
    where cou.over_time is null and (cou.user_id = #userId:INTEGER# OR cou.salegen_id=#userId:INTEGER# OR cou.finmanager_id=#userId:INTEGER#)
  </select>
  
  <select id="getCOUList" resultMap="abatorgenerated_SCustomerOwnerUserResult" parameterClass="java.util.Map" >
    select cou.customer_owner_user_id, c.customer_id, cou.user_id, cou.add_time, cou.over_time, cou.history_user_id, 
    u.user_name as user_name, c.FFullName as customer_name, sgu.user_name as salegen_name, fmu.user_name as finmanager_name,
    cou.salegen_id, cou.finmanager_id
    from t_customer c LEFT JOIN s_customer_owner_user cou  
    			ON c.customer_id = cou.customer_id and cou.over_time is null
		    left join s_user u on cou.user_id = u.user_id and cou.over_time is null
		    left join s_user sgu on cou.salegen_id = sgu.user_id and cou.over_time is null
	        left join s_user fmu on cou.finmanager_id = fmu.user_id and cou.over_time is null
    <dynamic prepend="where">
			<isNotNull property="customerId" prepend="and">
			    c.customer_id = #customerId:INTEGER#
			</isNotNull>
			<isNotEmpty property="customerName" prepend="and">
			    c.FFullName like  '%$customerName$%'
			</isNotEmpty>
			<isNotEmpty property="userName" prepend="and">
			    u.user_name like  '%$userName$%'
			</isNotEmpty>
			<isNotEmpty property="finmanagerName" prepend="and">
			    fmu.user_name like  '%$finmanagerName$%'
			</isNotEmpty>
			<isNotEmpty property="salegenName" prepend="and">
			    sgu.user_name like  '%$salegenName$%'
			</isNotEmpty>
			<isNotEmpty property="customerNumber" prepend="and">
			    c.FFullNumber like  '%$customerNumber$%'
			</isNotEmpty>
			<isNotNull property="customerIds" prepend="and">
				(not cou.user_id is null) and c.customer_id in $customerIds$ 
			</isNotNull>
			<isEqual property="oweredStatus"  compareValue="0" prepend="and">
				u.user_name is null
			</isEqual>
			<isEqual property="oweredStatus"  compareValue="1" prepend="and">
				not u.user_name is null
			</isEqual>
	</dynamic>
	order by c.fname
    limit #startRow#,#endRow#
  </select>
  
  <select id="getCOUCount" resultClass="java.lang.Integer"  parameterClass="java.util.Map">
      select count(*)
        from t_customer c LEFT JOIN s_customer_owner_user cou  
    			ON c.customer_id = cou.customer_id and cou.over_time is null
		    left join s_user u on cou.user_id = u.user_id and cou.over_time is null
		    left join s_user sgu on cou.salegen_id = sgu.user_id and cou.over_time is null
	        left join s_user fmu on cou.finmanager_id = fmu.user_id and cou.over_time is null
    <dynamic prepend="where">
			<isNotNull property="customerId" prepend="and">
			    c.customer_id = #customerId:INTEGER#
			</isNotNull>
			<isNotEmpty property="customerName" prepend="and">
			    c.FFullName like  '%$customerName$%'
			</isNotEmpty>
			<isNotEmpty property="userName" prepend="and">
			    u.user_name like  '%$userName$%'
			</isNotEmpty>
			<isNotEmpty property="finmanagerName" prepend="and">
			    fmu.user_name like  '%$finmanagerName$%'
			</isNotEmpty>
			<isNotEmpty property="salegenName" prepend="and">
			    sgu.user_name like  '%$salegenName$%'
			</isNotEmpty>
			<isNotEmpty property="customerNumber" prepend="and">
			    c.FFullNumber like  '%$customerNumber$%'
			</isNotEmpty>
			<isNotNull property="customerIds" prepend="and">
				(not cou.user_id is null) and c.customer_id in $customerIds$
			</isNotNull>
			<isEqual property="oweredStatus"  compareValue="0" prepend="and">
				u.user_name is null
			</isEqual>
			<isEqual property="oweredStatus"  compareValue="1" prepend="and">
				not u.user_name is null
			</isEqual>
	</dynamic>
  </select>

  <select id="getUserListByCustomerId" resultMap="abatorgenerated_SCustomerOwnerUserResult" parameterClass="java.lang.Integer" > 
    select cou.customer_owner_user_id, cou.customer_id, cou.user_id, cou.add_time, cou.over_time, cou.history_user_id, 
    u.user_name as user_name, c.FFullName as customer_name, sgu.user_name as salegen_name, fmu.user_name as finmanager_name,
    cou.salegen_id, cou.finmanager_id
    from s_customer_owner_user cou
    left join s_user u on cou.user_id = u.user_id
    left join t_customer c on cou.customer_id = c.customer_id
    left join s_user sgu on cou.salegen_id = sgu.user_id
	left join s_user fmu on cou.finmanager_id = fmu.user_id
    where cou.customer_id = #customerId:INTEGER#
  </select>
  
  <delete id="deleteByCustomerId" parameterClass="java.lang.Integer" >
    delete from s_customer_owner_user
    where customer_id = #customerId:INTEGER#
  </delete>
  
  <select id="getHistoryCOUList" resultMap="abatorgenerated_SCustomerOwnerUserResult" parameterClass="java.util.Map" >
    select cou.customer_owner_user_id, c.customer_id, cou.user_id, cou.add_time, cou.over_time, cou.history_user_id, 
    u.user_name as user_name, c.FFullName as customer_name, sgu.user_name as salegen_name, fmu.user_name as finmanager_name,
    cou.salegen_id, cou.finmanager_id
    from t_customer c LEFT JOIN s_customer_owner_user cou  
    			ON c.customer_id = cou.customer_id
		    left join s_user u on cou.history_user_id = u.user_id
		    left join s_user sgu on cou.salegen_id = sgu.user_id
	        left join s_user fmu on cou.finmanager_id = fmu.user_id
    where not cou.over_time is null and cou.customer_id = #customerId:INTEGER#

    limit #startRow#,#endRow#
  </select>
  
  <select id="getHistoryCOUCount" resultClass="java.lang.Integer"  parameterClass="java.util.Map">
      select count(*)
        from t_customer c LEFT JOIN s_customer_owner_user cou  
    			ON c.customer_id = cou.customer_id
		    left join s_user u on cou.history_user_id = u.user_id
		    where not cou.over_time is null and cou.customer_id = #customerId:INTEGER#
  </select>
  
</sqlMap>