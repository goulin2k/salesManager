<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="s_information" >
  <resultMap id="abatorgenerated_SInformationResult" class="com.sales.model.SInformation" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    <result column="information_id" property="informationId" jdbcType="INTEGER" />
    <result column="title" property="title" jdbcType="VARCHAR" />
    <result column="image_url" property="imageUrl" jdbcType="VARCHAR" />
    <result column="content" property="content" jdbcType="VARCHAR" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="resource" property="resource" jdbcType="VARCHAR" />
    <result column="add_time" property="addTime" jdbcType="TIMESTAMP" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="type" property="type" jdbcType="INTEGER" />
    <result column="send_user_id" property="sendUserId" jdbcType="INTEGER" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="send_user_name" property="sendUserName" jdbcType="VARCHAR" />
    <result column="buz_id" property="buzId" jdbcType="INTEGER" />
  </resultMap>
  
  <resultMap id="groupCount_result" class="com.sales.model.SimpleNameValue" >
  	<result column="title" property="name" jdbcType="VARCHAR" />
    <result column="count" property="value" jdbcType="VARCHAR" />
  </resultMap>
  <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_SInformationResult" parameterClass="com.sales.model.SInformation" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select i.information_id, i.title, i.image_url, i.content, i.user_id, i.resource, i.add_time, i.status, i.type, i.send_user_id,
    u.user_name as user_name, su.user_name as send_user_name, buz_id
    from s_information i
    left join s_user u on i.user_id = u.user_id
    left join s_user su on i.send_user_id = su.user_id
    where information_id = #informationId:INTEGER#
  </select>
  
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="com.sales.model.SInformation" >
    delete from s_information
    where information_id = #informationId:INTEGER#
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="com.sales.model.SInformation" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    insert into s_information (information_id, title, image_url, content, user_id, resource,
      add_time, status, type, send_user_id, buz_id)
    values (#informationId:INTEGER#, #title:VARCHAR#, #imageUrl:VARCHAR#, #content:VARCHAR#,
      #userId:INTEGER#, #resource:VARCHAR#, #addTime:TIMESTAMP#, #status:INTEGER#, #type:INTEGER#, #sendUserId:INTEGER#, #buzId:INTEGER#)
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="com.sales.model.SInformation" >
    
    update s_information
    set title = #title:VARCHAR#,
      image_url = #imageUrl:VARCHAR#,
      content = #content:VARCHAR#,
      user_id = #userId:INTEGER#,
      resource = #resource:VARCHAR#,
      add_time = #addTime:TIMESTAMP#,
      status = #status:INTEGER#,
      type = #type:INTEGER#,
      send_user_id = #sendUserId:INTEGER#
    where information_id = #informationId:INTEGER#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="com.sales.model.SInformation" >
    
    update s_information
    <dynamic prepend="set" >
      <isNotNull prepend="," property="title" >
        title = #title:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="imageUrl" >
        image_url = #imageUrl:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="content" >
        content = #content:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="userId" >
        user_id = #userId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="resource" >
        resource = #resource:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="addTime" >
        add_time = #addTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        status = #status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="type" >
        type = #type:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="sendUserId" >
        send_user_id = #sendUserId:INTEGER#
      </isNotNull>
    </dynamic>
    where information_id = #informationId:INTEGER#
  </update>
  
  <select id="getInfoListByUserId" resultMap="abatorgenerated_SInformationResult" parameterClass="java.util.Map" >
   
    select i.information_id, i.title, i.image_url, i.content, i.user_id, i.resource, i.add_time, i.status, i.type, i.send_user_id,
    u.user_name as user_name, su.user_name as send_user_name, buz_id
    from s_information i
    left join s_user u on i.user_id = u.user_id
    left join s_user su on i.send_user_id = su.user_id
    where i.send_user_id = #sendUserId:INTEGER#
    <isNotNull prepend="and" property="status">
      	i.status = #status:INTEGER#
      </isNotNull>
      
      <isEqual prepend="and" property="type" compareValue="1">
      	(title ='询价单' or title='销售报价单' or title='询价单回复')
      </isEqual>
      <isEqual prepend="and" property="type" compareValue="2">
      	(title ='销售订单' or title='采购申请单' or title='采购订单' or title='采购入库单' or title='销售发货通知单' or title='销售出库单' or title='销售发票' or title='销售收款单')
      </isEqual>
      <isEqual prepend="and" property="type" compareValue="3">
      	(title ='销售计划' or title='销售活动' or title ='销售评价')
      </isEqual>
      <isEqual prepend="and" property="type" compareValue="4">
      	(title='修改客户财务评价' or title='修改客户等级')
      </isEqual>
      
    order by i.add_time desc
    limit #startRow#,#endRow#
  </select>
  
  <select id="getInfoCountByUserId" resultClass="java.lang.Integer"  parameterClass="java.util.Map">
      select count(*) from s_information 
      where send_user_id = #sendUserId:INTEGER#
      <isNotNull prepend="and" property="status">
      	status = #status:INTEGER#
      </isNotNull>
      
      <isEqual prepend="and" property="type" compareValue="1">
      	(title ='询价单' or title='销售报价单' or title='询价单回复')
      </isEqual>
      <isEqual prepend="and" property="type" compareValue="2">
      	(title ='销售订单' or title='采购申请单' or title='采购订单' or title='采购入库单' or title='销售发货通知单' or title='销售出库单' or title='销售发票' or title='销售收款单')
      </isEqual>
      <isEqual prepend="and" property="type" compareValue="3">
      	(title ='销售计划' or title='销售活动' or title ='销售评价')
      </isEqual>
      <isEqual prepend="and" property="type" compareValue="4">
      	(title='修改客户财务评价' or title='采修改客户等级')
      </isEqual>
      
  </select>
  
  <select id="getInfoGroupByUserId" resultMap="groupCount_result"  parameterClass="java.util.Map">
  	select 'salePlan' as title,  count(*) as count from s_information 
	where send_user_id = #userId:INTEGER# and status = 1 and (title ='销售计划' or title='销售活动' or title ='销售评价' )
	union
	select 'saleQuota' as title, count(*) as count from s_information 
	where send_user_id = #userId:INTEGER# and status = 1 and (title ='询价单' or title='销售报价单' or title='询价单回复')
	union
	select 'saleProc' as title, count(*) as count from s_information 
	where send_user_id = #userId:INTEGER# and status = 1 and (title ='销售订单' or title='采购申请单' or title='采购订单' or title='采购入库单' or title='销售发货通知单' or title='销售出库单' or title='销售发票' or title='销售收款单')
	union
	select 'customer' as title, count(*) as count from s_information 
	where send_user_id = #userId:INTEGER# and status = 1 and (title='修改客户财务评价' or title='采修改客户等级' )
  	
  </select>
  
  <select id="getInfoListByStatus" resultMap="abatorgenerated_SInformationResult" parameterClass="java.util.Map" >
    select i.information_id, i.title, i.image_url, i.content, i.user_id, i.resource, i.add_time, i.status, i.type, i.send_user_id,
    u.user_name as user_name, su.user_name as send_user_name, buz_id
    from s_information i
    left join s_user u on i.user_id = u.user_id
    left join s_user su on i.send_user_id = su.user_id
    where i.status = #status:INTEGER# and i.send_user_id = #sendUserId:INTEGER#
    order by i.add_time desc
  </select>
  
  <update id="updateStatusByUrl" parameterClass="java.util.Map" >
    update s_information
    set status = #status:INTEGER#
    where send_user_id = #userId:INTEGER# and image_url = #imageUrl:VARCHAR#
  </update>
  
  <update id="updateStatusByUserId" parameterClass="java.util.Map" >
    update s_information
    set status = #status:INTEGER#
    where send_user_id = #userId:INTEGER# and status != #status:INTEGER#
  </update>
</sqlMap>