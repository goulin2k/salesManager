<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="s_car_repair_application" >
  <resultMap id="SCarRepairApplicationResult" class="com.sales.model.SCarRepairApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    <result column="car_application_id" property="carApplicationId" jdbcType="INTEGER" />
    <result column="car_application_code" property="carApplicationCode" jdbcType="VARCHAR" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="application_time" property="applicationTime" jdbcType="DATE" />
    <result column="repair_comment" property="repairComment" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="repair_time" property="repairTime" jdbcType="DATE" />
    <result column="repair_sum" property="repairSum" jdbcType="REAL" />
    <result column="uppercase" property="uppercase" jdbcType="VARCHAR" />
    <result column="plate_number" property="plateNumber" jdbcType="VARCHAR" />
    <result column="is_insurance" property="isInsurance" jdbcType="INTEGER" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
  </resultMap>
  <select id="selectByPrimaryKey" resultMap="SCarRepairApplicationResult" parameterClass="com.sales.model.SCarRepairApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select c.car_application_id, c.car_application_code, c.user_id, c.application_time, c.repair_comment,
      c.status, c.repair_time, c.repair_sum, c.uppercase, c.plate_number, c.is_insurance, u.user_name 
    from s_car_repair_application c 
    left join s_user u on c.user_id = u.user_id 
    where c.car_application_id = #carApplicationId:INTEGER#
  </select>
  <select id="getMaxCode" resultClass="java.lang.String">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select max(car_application_code) from s_car_repair_application where DATE_FORMAT(application_time,'%Y-%m-%d')  = curdate()
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="com.sales.model.SCarRepairApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    delete from s_car_repair_application
    where car_application_id = #carApplicationId:INTEGER#
  </delete>
  <insert id="insert" parameterClass="com.sales.model.SCarRepairApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    insert into s_car_repair_application (car_application_id, car_application_code, user_id,
      application_time, repair_comment, status, repair_time, repair_sum, uppercase, plate_number,
      is_insurance)
    values (#carApplicationId:INTEGER#, #carApplicationCode:VARCHAR#, #userId:INTEGER#,
      #applicationTime:TIMESTAMP#, #repairComment:VARCHAR#, #status:INTEGER#, #repairTime:DATE#,
      #repairSum:REAL#, #uppercase:VARCHAR#, #plateNumber:VARCHAR#, #isInsurance:INTEGER#) 
      <selectKey resultClass="int" keyProperty="carApplicationId">
		select LAST_INSERT_ID() as carApplicationId
	  </selectKey>
  </insert>
  <update id="updateByPrimaryKey" parameterClass="com.sales.model.SCarRepairApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    update s_car_repair_application
    set car_application_code = #carApplicationCode:VARCHAR#,
      user_id = #userId:INTEGER#,
      application_time = #applicationTime:DATE#,
      repair_comment = #repairComment:VARCHAR#,
      status = #status:INTEGER#,
      repair_time = #repairTime:DATE#,
      repair_sum = #repairSum:REAL#,
      uppercase = #uppercase:VARCHAR#,
      plate_number = #plateNumber:VARCHAR#,
      is_insurance = #isInsurance:INTEGER#
    where car_application_id = #carApplicationId:INTEGER#
  </update>
  <update id="updateByPrimaryKeySelective" parameterClass="com.sales.model.SCarRepairApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    update s_car_repair_application
    <dynamic prepend="set" >
      <isNotNull prepend="," property="carApplicationCode" >
        car_application_code = #carApplicationCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="userId" >
        user_id = #userId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="applicationTime" >
        application_time = #applicationTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="repairComment" >
        repair_comment = #repairComment:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        status = #status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="repairTime" >
        repair_time = #repairTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="repairSum" >
        repair_sum = #repairSum:REAL#
      </isNotNull>
      <isNotNull prepend="," property="uppercase" >
        uppercase = #uppercase:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="plateNumber" >
        plate_number = #plateNumber:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="isInsurance" >
        is_insurance = #isInsurance:INTEGER#
      </isNotNull>
    </dynamic>
    where car_application_id = #carApplicationId:INTEGER#
  </update>
  
  <select id="getCarApplicationListPage" resultMap="SCarRepairApplicationResult" parameterClass="com.sales.model.SCarRepairApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select c.car_application_id, c.car_application_code, c.user_id, c.application_time, c.repair_comment,
      c.status, c.repair_time, c.repair_sum, c.uppercase, c.plate_number, c.is_insurance, u.user_name 
    from s_car_repair_application c 
    left join s_user u on c.user_id = u.user_id 
    <dynamic prepend="where">
        <isNotEmpty prepend="and" property="userId">
			c.user_id = #userId# 
		</isNotEmpty>
        <isNotEmpty prepend="and" property="applicationTime">
			c.application_time = #applicationTime# 
		</isNotEmpty>
		
	</dynamic>
	order by c.application_time desc 
	<dynamic prepend="limit">
		<isNotNull property="pageStart">
			<isNotNull property="pageSize">#pageStart#, #pageSize#</isNotNull>
		</isNotNull>
	</dynamic>
  </select>
  
  <select id="getCarApplicationListPageCount" resultClass="java.lang.Integer" parameterClass="com.sales.model.SCarRepairApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select count(c.car_application_id)  
    from s_car_repair_application c 
    left join s_user u on c.user_id = u.user_id 
    <dynamic prepend="where">
        <isNotEmpty prepend="and" property="userId">
			c.user_id = #userId# 
		</isNotEmpty>
        <isNotEmpty prepend="and" property="applicationTime">
			c.application_time = #applicationTime# 
		</isNotEmpty>
		
	</dynamic>
  </select>
  
  <select id="getCarApplicationListForReimbursement" resultMap="SCarRepairApplicationResult" parameterClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select c.car_application_id, c.car_application_code, c.user_id, c.application_time, c.repair_comment,
      c.status, c.repair_time, c.repair_sum, c.uppercase, c.plate_number, c.is_insurance, u.user_name 
    from s_car_repair_application c 
    left join s_user u on c.user_id = u.user_id 
    <!-- left join s_car_repair_reimbursement r on c.car_application_id = r.car_application_id   -->
    where c.user_id = #userId# <!-- and r.car_reimbursement_id is null --> and c.status = 1 
	order by c.application_time desc 
	
  </select>
</sqlMap>