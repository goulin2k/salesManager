<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="s_customer_linkman" >
  <resultMap id="abatorgenerated_SCustomerLinkmanResult" class="com.sales.model.SCustomerLinkman" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    <result column="linkman_id" property="linkmanId" jdbcType="INTEGER" />
    <result column="customer_id" property="customerId" jdbcType="INTEGER" />
    <result column="station" property="station" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="department" property="department" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="fax" property="fax" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="relation_us" property="relationUs" jdbcType="INTEGER" />
    <result column="relation_comp" property="relationComp" jdbcType="INTEGER" />
    <result column="relation_us_name" property="relationUsName" jdbcType="VARCHAR" />
    <result column="relation_comp_name" property="relationCompName" jdbcType="VARCHAR" />
    <result column="customer_name" property="customerName" jdbcType="VARCHAR" />
    <result column="hobbies" property="hobbies" jdbcType="VARCHAR" />
    <result column="birthday" property="birthday" jdbcType="DATE" />
    
  </resultMap>
  
  <resultMap class="com.sales.model.CustomerLinkmanStatics" id="linkmanStatics">
  	<result column="customer_id" property="customerId" jdbcType="INTEGER" />
  	<result column="linkman_type" property="linkType" jdbcType="INTEGER" />
  	<result column="count" property="count" jdbcType="INTEGER" />
  </resultMap>
  
  <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_SCustomerLinkmanResult" parameterClass="com.sales.model.SCustomerLinkman" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select cl.linkman_id, cl.customer_id, cl.station, cl.name, cl.department, cl.mobile, cl.phone, cl.email, cl.relation_us, cl.relation_comp,
    rus.enumeration_name as relation_us_name,cus.enumeration_name as relation_comp_name, c.FFullName as customer_name, cl.fax,
    cl.hobbies, cl.birthday
    from s_customer_linkman cl
    left join s_enumeration rus on cl.relation_us=rus.enumeration_id
    left join s_enumeration cus on cl.relation_comp=cus.enumeration_id
    left join t_customer c on cl.customer_id = c.customer_id
    where cl.linkman_id = #linkmanId:INTEGER#
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="com.sales.model.SCustomerLinkman" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    delete from s_customer_linkman
    where linkman_id = #linkmanId:INTEGER#
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="com.sales.model.SCustomerLinkman" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    insert into s_customer_linkman (linkman_id, customer_id, station, name, department,
      mobile, phone, email, relation_us, relation_comp, hobbies, birthday, fax)
    values (#linkmanId:INTEGER#, #customerId:INTEGER#, #station:VARCHAR#, #name:VARCHAR#,
      #department:VARCHAR#, #mobile:VARCHAR#, #phone:VARCHAR#, #email:VARCHAR#, #relationUs:INTEGER#, 
      #relationComp:INTEGER#, #hobbies:VARCHAR#, #birthday:DATE#, #fax:VARCHAR#)
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="com.sales.model.SCustomerLinkman" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    update s_customer_linkman
    set customer_id = #customerId:INTEGER#,
      station = #station:VARCHAR#,
      name = #name:VARCHAR#,
      department = #department:VARCHAR#,
      mobile = #mobile:VARCHAR#,
      phone = #phone:VARCHAR#,
      fax = #fax:VARCHAR#,
      email = #email:VARCHAR#,
      relation_us = #relationUs:INTEGER#,
      relation_comp = #relationComp:INTEGER#,
      hobbies = #hobbies:VARCHAR#,
      birthday = #birthday:DATE#
    where linkman_id = #linkmanId:INTEGER#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="com.sales.model.SCustomerLinkman" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    update s_customer_linkman
    <dynamic prepend="set" >
      <isNotNull prepend="," property="customerId" >
        customer_id = #customerId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="station" >
        station = #station:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="name" >
        name = #name:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="department" >
        department = #department:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="mobile" >
        mobile = #mobile:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="phone" >
        phone = #phone:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="fax" >
        fax = #fax:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="email" >
        email = #email:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="relationUs" >
        relation_us = #relationUs:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="relationComp" >
        relation_comp = #relationComp:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="hobbies" >
        hobbies = #hobbies:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="birthday" >
        birthday = #birthday:DATE#
      </isNotNull>
    </dynamic>
    where linkman_id = #linkmanId:INTEGER#
  </update>
  
  <select id="getLinkmanList" resultMap="abatorgenerated_SCustomerLinkmanResult" parameterClass="java.util.Map" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select cl.linkman_id, cl.customer_id, cl.station, cl.name, cl.department, cl.mobile, cl.phone, cl.email, cl.relation_us, cl.relation_comp,
    rus.enumeration_name as relation_us_name,cus.enumeration_name as relation_comp_name, c.FFullName as customer_name,
    cl.hobbies, cl.birthday, cl.fax
    from s_customer_linkman cl
    left join s_enumeration rus on cl.relation_us=rus.enumeration_id
    left join s_enumeration cus on cl.relation_comp=cus.enumeration_id
    left join t_customer c on cl.customer_id = c.customer_id
    <dynamic prepend="where">
			<isNotNull property="name" prepend="and">
			    cl.name like '%$name$%'
			</isNotNull>
			<isNotNull property="customerName" prepend="and">
			    c.FFullName like '%$customerName$%'
			</isNotNull>
			<isNotNull property="customerOwnerUserName" prepend="and">
			cl.customer_id in (select customer_id from s_customer_owner_user where user_id in (select user_id from s_user where user_name like '%$customerOwnerUserName$%'))
			</isNotNull>
		</dynamic>
    limit #startRow#,#endRow#
  </select>
  
  <select id="getLinkmanCount" resultClass="java.lang.Integer"  parameterClass="java.util.Map">
      select count(*) from s_customer_linkman cl
      left join t_customer c on cl.customer_id = c.customer_id
      <dynamic prepend="where">
			<isNotNull property="name" prepend="and">
			    cl.name like '%$name$%'
			</isNotNull>
			<isNotNull property="customerName" prepend="and">
			    c.FFullName like '%$customerName$%'
			</isNotNull>
			<isNotNull property="customerOwnerUserName" prepend="and">
			cl.customer_id in (select customer_id from s_customer_owner_user where user_id in (select user_id from s_user where user_name like '%$customerOwnerUserName$%'))
			</isNotNull>
		</dynamic>
  </select>
  
  <select id="getLinkmanListByCustomerId" resultMap="abatorgenerated_SCustomerLinkmanResult" parameterClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select cl.linkman_id, cl.customer_id, cl.station, cl.name, cl.department, cl.mobile, cl.phone, cl.email, cl.relation_us, cl.relation_comp,
    rus.enumeration_name as relation_us_name,cus.enumeration_name as relation_comp_name, c.FFullName as customer_name,
    cl.hobbies, cl.birthday, cl.fax
    from s_customer_linkman cl
    left join s_enumeration rus on cl.relation_us=rus.enumeration_id
    left join s_enumeration cus on cl.relation_comp=cus.enumeration_id
    left join t_customer c on cl.customer_id = c.customer_id
    where cl.customer_id = #customerId#;
  </select>
  
  <select id="getLinkmanListByCustomerIds" resultMap="abatorgenerated_SCustomerLinkmanResult" parameterClass="java.util.Map" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select cl.linkman_id, cl.customer_id, cl.station, cl.name, cl.department, cl.mobile, cl.phone, cl.email, cl.relation_us, cl.relation_comp,
    rus.enumeration_name as relation_us_name,cus.enumeration_name as relation_comp_name, c.FFullName as customer_name,
    cl.hobbies, cl.birthday, cl.fax
    from s_customer_linkman cl
    left join s_enumeration rus on cl.relation_us=rus.enumeration_id
    left join s_enumeration cus on cl.relation_comp=cus.enumeration_id
    left join t_customer c on cl.customer_id = c.customer_id
    <dynamic prepend="where">
			<isNotNull property="name" prepend="and">
			    cl.name like '%$name$%'
			</isNotNull>
			<isNotNull property="customerName" prepend="and">
			    c.FFullName like '%$customerName$%'
			</isNotNull>
			<isNotNull property="customerIds" prepend="and">
			    cl.customer_id in $customerIds$
			</isNotNull>
		</dynamic>
    limit #startRow#,#endRow#
  </select>
  
  <select id="getLinkmanCountByCustomerIds" resultClass="java.lang.Integer"  parameterClass="java.util.Map">
      select count(*) from s_customer_linkman cl
      left join t_customer c on cl.customer_id = c.customer_id 
      <dynamic prepend="where">
			<isNotNull property="name" prepend="and">
			    cl.name like '%$name$%'
			</isNotNull>
			<isNotNull property="customerName" prepend="and">
			    c.FFullName like '%$customerName$%'
			</isNotNull>
			<isNotNull property="customerIds" prepend="and">
			    cl.customer_id in $customerIds$
			</isNotNull>
		</dynamic>
      
  </select>
  
  <!-- 客户联系人统计信息查询  -->
  <select id="getCustomerLinkmanStatis" resultMap="linkmanStatics"  parameterClass="java.lang.Integer">
      	SELECT  $customerId$ as customer_id, '1' AS linkman_type ,COUNT(*) AS count
		FROM 	s_customer_linkman
		WHERE	station LIKE '%采购%' AND customer_id = $customerId$
		UNION
		SELECT  $customerId$ as customer_id, '2' AS linkman_type , COUNT(*) AS count
		FROM 	s_customer_linkman
		WHERE	station LIKE '%技术%' AND customer_id = $customerId$
		UNION
		SELECT  $customerId$ as customer_id, '3' AS linkman_type , COUNT(*) AS count
		FROM 	s_customer_linkman
		WHERE	NOT station LIKE '%技术%' AND NOT station LIKE '%采购%' AND customer_id = $customerId$
      
  </select>
</sqlMap>