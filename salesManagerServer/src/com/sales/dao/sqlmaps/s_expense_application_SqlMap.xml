<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="s_expense_application" >
  <resultMap id="SExpenseApplicationResult" class="com.sales.model.SExpenseApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    <result column="expense_application_id" property="expenseApplicationId" jdbcType="INTEGER" />
    <result column="type_id" property="typeId" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="expense_user_id" property="expenseUserId" jdbcType="INTEGER" />
    <result column="expense_time" property="expenseTime" jdbcType="DATE" />
    <result column="comment" property="comment" jdbcType="VARCHAR" />
    <result column="loan_sum" property="loanSum" jdbcType="REAL" />
    <result column="uppercase" property="uppercase" jdbcType="VARCHAR" />
    <result column="expense_application_code" property="expenseApplicationCode" jdbcType="VARCHAR" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="selectByPrimaryKey" resultMap="SExpenseApplicationResult" parameterClass="com.sales.model.SExpenseApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select a.expense_application_id, a.type_id, a.status, a.expense_user_id, a.expense_time, a.comment,
      a.loan_sum, a.uppercase, a.expense_application_code, u.user_name 
    from s_expense_application a 
    left join s_user u on a.expense_user_id = u.user_id 
    where a.expense_application_id = #expenseApplicationId:INTEGER#
  </select>
  <select id="getMaxCode" resultClass="java.lang.String">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select max(expense_application_code) from s_expense_application where DATE_FORMAT(expense_time,'%Y-%m-%d')  = curdate()
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="com.sales.model.SExpenseApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    delete from s_expense_application
    where expense_application_id = #expenseApplicationId:INTEGER#
  </delete>
  <insert id="insert" parameterClass="com.sales.model.SExpenseApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    insert into s_expense_application (expense_application_id, type_id, status, expense_user_id,
      expense_time, comment, loan_sum, uppercase, expense_application_code)
    values (#expenseApplicationId:INTEGER#, #typeId:INTEGER#, #status:INTEGER#,
      #expenseUserId:INTEGER#, #expenseTime:TIMESTAMP#, #comment:VARCHAR#, #loanSum:REAL#,
      #uppercase:VARCHAR#, #expenseApplicationCode:VARCHAR#)
      <selectKey resultClass="int" keyProperty="expenseApplicationId">
		select LAST_INSERT_ID() as expenseApplicationId
	  </selectKey>
  </insert>
  <update id="updateByPrimaryKey" parameterClass="com.sales.model.SExpenseApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    update s_expense_application
    set type_id = #typeId:INTEGER#,
      status = #status:INTEGER#,
      expense_user_id = #expenseUserId:INTEGER#,
      expense_time = #expenseTime:DATE#,
      comment = #comment:VARCHAR#,
      loan_sum = #loanSum:REAL#,
      uppercase = #uppercase:VARCHAR#,
      expense_application_code = #expenseApplicationCode:VARCHAR#
    where expense_application_id = #expenseApplicationId:INTEGER#
  </update>
  <update id="updateByPrimaryKeySelective" parameterClass="com.sales.model.SExpenseApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    update s_expense_application
    <dynamic prepend="set" >
      <isNotNull prepend="," property="typeId" >
        type_id = #typeId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        status = #status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="expenseUserId" >
        expense_user_id = #expenseUserId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="expenseTime" >
        expense_time = #expenseTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="comment" >
        comment = #comment:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="loanSum" >
        loan_sum = #loanSum:REAL#
      </isNotNull>
      <isNotNull prepend="," property="uppercase" >
        uppercase = #uppercase:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="expenseApplicationCode" >
        expense_application_code = #expenseApplicationCode:VARCHAR#
      </isNotNull>
    </dynamic>
    where expense_application_id = #expenseApplicationId:INTEGER#
  </update>
  
  <select id="getExpenseApplicationListPage" resultMap="SExpenseApplicationResult" parameterClass="com.sales.model.SExpenseApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select a.expense_application_id, a.type_id, a.status, a.expense_user_id, a.expense_time, a.comment,
      a.loan_sum, a.uppercase, a.expense_application_code, u.user_name 
    from s_expense_application a 
    left join s_user u on a.expense_user_id = u.user_id 
    <dynamic prepend="where">
        <isNotEmpty prepend="and" property="expenseUserId">
			a.expense_user_id = #expenseUserId# 
		</isNotEmpty>
        <isNotEmpty prepend="and" property="expenseTime">
			a.expense_time = #expenseTime# 
		</isNotEmpty>
		<isNotEmpty property="typeId">
		    <isNotEqual prepend="and" property="typeId" compareValue = "-1">
			    a.type_id = #typeId#
			</isNotEqual>
		</isNotEmpty>
	</dynamic>
	order by a.expense_time desc 
	<dynamic prepend="limit">
		<isNotNull property="pageStart">
			<isNotNull property="pageSize">#pageStart#, #pageSize#</isNotNull>
		</isNotNull>
	</dynamic>
  </select>
  
  <select id="getExpenseApplicationListPageCount" resultClass="java.lang.Integer" parameterClass="com.sales.model.SExpenseApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select count(a.expense_application_id) 
    from s_expense_application a 
    left join s_user u on a.expense_user_id = u.user_id 
    <dynamic prepend="where">
        <isNotEmpty prepend="and" property="expenseUserId">
			a.expense_user_id = #expenseUserId# 
		</isNotEmpty>
        <isNotEmpty prepend="and" property="expenseTime">
			a.expense_time = #expenseTime# 
		</isNotEmpty>
		<isNotEmpty property="typeId">
		    <isNotEqual prepend="and" property="typeId" compareValue = "-1">
			    a.type_id = #typeId#
			</isNotEqual>
		</isNotEmpty>
	</dynamic>
  </select>
  
  <select id="getExpenseApplicationListForReimbursement" resultMap="SExpenseApplicationResult" parameterClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select a.expense_application_id, a.type_id, a.status, a.expense_user_id, a.expense_time, a.comment,
      a.loan_sum, a.uppercase, a.expense_application_code, u.user_name 
    from s_expense_application a 
    left join s_user u on a.expense_user_id = u.user_id 
    <!-- left join s_expense_reimbursement r on (a.expense_application_id= r.expense_application_id and r.type=1 ) -->
    where a.expense_user_id = #userId# <!-- and r.reimbursement_id is null --> and a.status=1 
	order by a.expense_time desc 
	
  </select>
</sqlMap>