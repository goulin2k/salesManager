<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="s_overtime">
  <resultMap class="com.sales.model.SOvertime" id="SOvertimeResult">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue May 14 23:13:43 CST 2013.
    -->
    <result column="overtime_id" jdbcType="INTEGER" property="overtimeId" />
    <result column="user_id" jdbcType="INTEGER" property="userId" />
    <result column="start_time" jdbcType="DATE" property="startTime" />
    <result column="hours" jdbcType="REAL" property="hours" />
    <result column="comment" jdbcType="VARCHAR" property="comment" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="overtime_time" jdbcType="DATE" property="overtimeTime" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="overtime_code" property="overtimeCode" jdbcType="VARCHAR" />
  </resultMap>
  <select id="selectByPrimaryKey" parameterClass="com.sales.model.SOvertime" resultMap="SOvertimeResult">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue May 14 23:13:43 CST 2013.
    -->
    select o.overtime_id, o.user_id, o.start_time, o.hours, o.comment, o.status, o.overtime_time, u.user_name, o.overtime_code 
    from s_overtime o left join s_user u on o.user_id = u.user_id 
    where o.overtime_id = #overtimeId:INTEGER#
  </select>
    <select id="getMaxCode" resultClass="java.lang.String">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select max(overtime_code) from s_overtime where DATE_FORMAT(overtime_time,'%Y-%m-%d')  = curdate()
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="com.sales.model.SOvertime">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue May 14 23:13:43 CST 2013.
    -->
    delete from s_overtime
    where overtime_id = #overtimeId:INTEGER#
  </delete>
  <insert id="insert" parameterClass="com.sales.model.SOvertime">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue May 14 23:13:43 CST 2013.
    -->
    insert into s_overtime (overtime_id, user_id, start_time, hours, comment, status, overtime_time, overtime_code)
    values (#overtimeId:INTEGER#, #userId:INTEGER#, #startTime:DATE#, #hours:REAL#,
      #comment:VARCHAR#, #status:INTEGER#, #overtimeTime:TIMESTAMP#, #overtimeCode:VARCHAR#)
      <selectKey resultClass="int" keyProperty="overtimeId">
		select LAST_INSERT_ID() as overtimeId
	  </selectKey>
  </insert>
  <update id="updateByPrimaryKey" parameterClass="com.sales.model.SOvertime">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue May 14 23:13:43 CST 2013.
    -->
    update s_overtime
    set user_id = #userId:INTEGER#,
      start_time = #startTime:DATE#,
      hours = #hours:REAL#,
      comment = #comment:VARCHAR#,
      status = #status:INTEGER#,
      overtime_time = #overtimeTime:DATE#
    where overtime_id = #overtimeId:INTEGER#
  </update>
  <update id="updateByPrimaryKeySelective" parameterClass="com.sales.model.SOvertime">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue May 14 23:13:43 CST 2013.
    -->
    update s_overtime
    <dynamic prepend="set">
      <isNotNull prepend="," property="userId">
        user_id = #userId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="startTime">
        start_time = #startTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="hours">
        hours = #hours:REAL#
      </isNotNull>
      <isNotNull prepend="," property="comment">
        comment = #comment:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status">
        status = #status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="overtimeTime">
        overtime_time = #overtimeTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="overtimeCode">
        overtime_code = #overtimeCode:VARCHAR#
      </isNotNull>
    </dynamic>
    where overtime_id = #overtimeId:INTEGER#
  </update>
  
  <select id="getOvertimeListPage" parameterClass="com.sales.model.SOvertime" resultMap="SOvertimeResult">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue May 14 23:13:43 CST 2013.
    -->
    select o.overtime_id, o.user_id, o.start_time, o.hours, o.comment, o.status, o.overtime_time, u.user_name, o.overtime_code 
    from s_overtime o left join s_user u on o.user_id = u.user_id 
    <dynamic prepend="where">
        <isNotEmpty prepend="and" property="userId">
			o.user_id = #userId# 
		</isNotEmpty>
		<isNotEmpty prepend="and" property="startTime">
			o.start_time = #startTime# 
		</isNotEmpty>
	</dynamic>
	order by o.overtime_time desc 
	<dynamic prepend="limit">
		<isNotNull property="pageStart">
			<isNotNull property="pageSize">#pageStart#, #pageSize#</isNotNull>
		</isNotNull>
	</dynamic>
  </select>
  
  <select id="getOvertimeListPageCount" resultClass="java.lang.Integer"  parameterClass="com.sales.model.SOvertime">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue May 14 23:13:43 CST 2013.
    -->
    select count(o.overtime_id) 
    from s_overtime o left join s_user u on o.user_id = u.user_id 
    <dynamic prepend="where">
        <isNotEmpty prepend="and" property="userId">
			o.user_id = #userId# 
		</isNotEmpty>
		<isNotEmpty prepend="and" property="startTime">
			o.start_time = #startTime# 
		</isNotEmpty>
	</dynamic>
  </select>
</sqlMap>