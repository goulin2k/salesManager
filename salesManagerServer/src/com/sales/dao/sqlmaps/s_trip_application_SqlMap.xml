<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="s_trip_application" >
  <resultMap id="STripApplicationResult" class="com.sales.model.STripApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:31 CST 2013.
    -->
    <result column="trip_id" property="tripId" jdbcType="INTEGER" />
    <result column="user_id" property="userId" jdbcType="INTEGER" />
    <result column="trip_location" property="tripLocation" jdbcType="VARCHAR" />
    <result column="trip_comment" property="tripComment" jdbcType="VARCHAR" />
    <result column="start_time" property="startTime" jdbcType="DATE" />
    <result column="end_time" property="endTime" jdbcType="DATE" />
    <result column="agent" property="agent" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="trip_time" property="tripTime" jdbcType="DATE" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="trip_code" property="tripCode" jdbcType="VARCHAR" />
  </resultMap>
  <select id="selectByPrimaryKey" resultMap="STripApplicationResult" parameterClass="com.sales.model.STripApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:31 CST 2013.
    -->
    select t.trip_id, t.user_id, t.trip_location, t.trip_comment, t.start_time, t.end_time, t.agent, t.status,
      t.trip_time,t.trip_code,u.user_name 
    from s_trip_application t
    left join s_user u on t.user_id = u.user_id 
    where t.trip_id = #tripId:INTEGER#
  </select>
  <select id="getMaxCode" resultClass="java.lang.String">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select max(trip_code) from s_trip_application where DATE_FORMAT(trip_time,'%Y-%m-%d')  = curdate()
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="com.sales.model.STripApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:31 CST 2013.
    -->
    delete from s_trip_application
    where trip_id = #tripId:INTEGER#
  </delete>
  <insert id="insert" parameterClass="com.sales.model.STripApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:31 CST 2013.
    -->
    insert into s_trip_application (trip_id, user_id, trip_location, trip_comment, start_time,
      end_time, agent, status, trip_time, trip_code)
    values (#tripId:INTEGER#, #userId:INTEGER#, #tripLocation:VARCHAR#, #tripComment:VARCHAR#,
      #startTime:DATE#, #endTime:DATE#, #agent:VARCHAR#, #status:INTEGER#, #tripTime:TIMESTAMP#, #tripCode:VARCHAR#) 
      <selectKey resultClass="int" keyProperty="tripId">
		select LAST_INSERT_ID() as tripId
	  </selectKey>
  </insert>
  <update id="updateByPrimaryKey" parameterClass="com.sales.model.STripApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:31 CST 2013.
    -->
    update s_trip_application
    set user_id = #userId:INTEGER#,
      trip_location = #tripLocation:VARCHAR#,
      trip_comment = #tripComment:VARCHAR#,
      start_time = #startTime:DATE#,
      end_time = #endTime:DATE#,
      agent = #agent:VARCHAR#,
      status = #status:INTEGER#,
      trip_time = #tripTime:DATE#,
      trip_code = #tripCode:VARCHAR#
    where trip_id = #tripId:INTEGER#
  </update>
  <update id="updateByPrimaryKeySelective" parameterClass="com.sales.model.STripApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:31 CST 2013.
    -->
    update s_trip_application
    <dynamic prepend="set" >
      <isNotNull prepend="," property="userId" >
        user_id = #userId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="tripLocation" >
        trip_location = #tripLocation:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="tripComment" >
        trip_comment = #tripComment:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="startTime" >
        start_time = #startTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="endTime" >
        end_time = #endTime:DATE#
      </isNotNull>
      <isNotNull prepend="," property="agent" >
        agent = #agent:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        status = #status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="tripTime" >
        trip_time = #tripTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="tripCode" >
        trip_code = #tripCode:VARCHAR#
      </isNotNull>
    </dynamic>
    where trip_id = #tripId:INTEGER#
  </update>
  
    <select id="getTripApplicationListPage" resultMap="STripApplicationResult" parameterClass="com.sales.model.STripApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select t.trip_id, t.user_id, t.trip_location, t.trip_comment, t.start_time, t.end_time, t.agent, t.status,
      t.trip_time,t.trip_code,u.user_name 
    from s_trip_application t
    left join s_user u on t.user_id = u.user_id 
    <dynamic prepend="where">
        <isNotEmpty prepend="and" property="userId">
			t.user_id = #userId# 
		</isNotEmpty>
        <isNotEmpty prepend="and" property="tripTime">
			t.trip_time = #tripTime# 
		</isNotEmpty>
		
	</dynamic>
	order by t.trip_time desc 
	<dynamic prepend="limit">
		<isNotNull property="pageStart">
			<isNotNull property="pageSize">#pageStart#, #pageSize#</isNotNull>
		</isNotNull>
	</dynamic>
  </select>
  
  <select id="getTripApplicationListPageCount" resultClass="java.lang.Integer" parameterClass="com.sales.model.STripApplication" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select count(t.trip_id)  
    from s_trip_application t
    left join s_user u on t.user_id = u.user_id 
    <dynamic prepend="where">
        <isNotEmpty prepend="and" property="userId">
			t.user_id = #userId# 
		</isNotEmpty>
       <isNotEmpty prepend="and" property="tripTime">
			t.trip_time = #tripTime# 
		</isNotEmpty>
		
	</dynamic>
  </select>
  
  <select id="getTripApplicationListForReimbursement" resultMap="STripApplicationResult" parameterClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Apr 23 17:36:30 CST 2013.
    -->
    select t.trip_id, t.user_id, t.trip_location, t.trip_comment, t.start_time, t.end_time, t.agent, t.status,
      t.trip_time,t.trip_code,u.user_name 
    from s_trip_application t
    left join s_user u on t.user_id = u.user_id 
    <!-- left join s_expense_reimbursement r on (t.trip_id = r.expense_application_id and r.type=2 ) -->
    where t.user_id = #userId# <!-- and r.reimbursement_id is null --> and t.status=1 
	order by t.trip_time desc 
	
  </select>
</sqlMap>